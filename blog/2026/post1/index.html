<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Firefox Remote Crash</title>
    <meta name="author" content="Caleb Lerch" />
    <meta name="description" content="My personal journey and portfolio into the world of information security and ethical hacking." />
    <meta name="keywords" content="Caleb Lerch, hacking, security, cybersecurity, research, certification, analyst" />


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous" />

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light" />

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://stomper4.github.io/blog/2025/post1/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark" />

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    
    <style>
    table, table th, table td {
  color: var(--global-text-color);
  /* Optional: if you want lighter text for headers */
  /* color: var(--global-text-color-light); */
}


    </style>


  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="https://stomper4.github.io/"><span class="font-weight-bold">Caleb</span>   Lerch</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">blog</a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">projects</a>
              </li>

              <!-- Toogle theme mode -->
              <div class="toggle-container">
                <a id="light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </a>
              </div>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Content -->
    <div class="container mt-5">
      <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Firefox Remote Crash</h1>
    <p class="post-meta">January 13, 2026</p>
    <p class="post-tags">
      <a href="/blog/2026"> <i class="fas fa-calendar fa-sm"></i> 2026 </a>

    </p>
  </header>

  <article class="post-content">

    <p> CVE-2026-0889 is a Firefox remote crash triggered by registering an oversized service worker. This research was a joint effort with Elysee Franchuk, who discovered the condition while we both explored potential attack paths. This post will describe my process performing the root cause analysis, as well as the patch analysis.</p>

    <p> After verifying the crash, the first addition to my lab was the <a href=https://rr-project.org/>Record and Replay Framework</a> (rr). This tool allowed me to record the application crash in the GNU debugger and replay it as many times as I needed. I stepped forwards and backwards through key events in the debugger to better understand the conditions and the code. </p>

    <p> Starting RR to record the crash. Link to ./pcores explanation <a href=https://linuxjedi.co.uk/using-rr-on-newer-intel-cpus/>here</a>.

    <img class="img-fluid z-dept-1 rounded shadow" src="/assets/img/Firefox1.png"></p>

    <p> The first area of the code that I investigated was the cause of the SIGSEV error. (SIGSEV is the code for a segmentation fault in linux.) I found a null pointer dereference, which was hardcoded in the source code. (Image below) This was confusing to me, and emphasized the need for a debugging build, so I could compare the information I am seeing in the debugger with the source code. </p>

    <p> The assembly code clearing the A register, then copying a value to the location stored in the register. 
    
      <img class="img-fluid z-dept-1 rounded shadow" src="/assets/img/Firefox2.png"></p>

    <p>This code turned out to be part of a defensive function, causing a crash when unstable conditions are discovered during runtime. Causing an immediate crash may save key information about the cause in the crash logs, and prevents further exploitation of the condition. </p>

    <p>At this point I had added a tool to my home lab and learned how to use it, but I had not found the root cause of the crash. To fill some gaps I cloned the Firefox git repository which contains all the source code. I customized the compiler options and built Firefox locally. This build:
    <ul>
      <li>Printed additional error information to my terminal when running.</li>
      <li>Allowed the debugger to show the file and line of the source code for every instruction I stopped at.</li>
    </ul>  
    </p>

    <p> I ran my new Firefox build with rr and recreated the crash. An assertion error printed to my terminal.  
      <pre style="white-space: pre-wrap; word-wrap: break-word;"><code>[803288] Assertion failure: aLength <= kMax (string is too large), at /home/caleb/Documents/SecRe/firefox/firefox/xpcom/string/nsTStringRepr.h:89</code></pre></p>

    <p>The Firefox source code is by far the largest repo I have tried to understand. Starting at the file nsTStringRepr.h and working backwards to the input source, as well as comparing what I was reading to real instructions recorded in my debugger helped me to sort out the cause of the fault.</p>

    <p>nsTStringRepr.h shows that the "size" attribute of a string is stored in a uint32 variable type. (Max size of 0xFFFFFFFF) There is a check to confirm the size is small enough to be cast to an int32 (Max size 0x7FFFFFFF) which may happen later in the program. The assertion error occurs when the actual string size is larger than an int32 and smaller than an uint32. </p>

    <p>The memory map of the program, showing the relevant heap allocation with size 0x80000000.

      <img class="img-fluid z-dept-1 rounded shadow" src="/assets/img/Firefox3.png"></p>
    </p>

    <p>Throughout this project I recorded several instances of the crash, I frequently took breaks and then restarted. I picked up a little trick with rr to jump into the relevant code sections quickly:
      <ul>
        <li>Search the dump file for a the fault with a command like: <code>rr dump | grep -E "SIG(SEGV|ABRT|BUS|ILL|FPE)"</code></li>
      <li>Note the global time of the fault.</li>
      <li>Use the goto option in rr to replay the program until it opens the debugger at that time. </li>
      </ul> 
      This allowed me to stop the debugger close to the right location without knowing what function to add a breakpoint to.</p>

    <p>The replay command I would use for this output is <code>rr replay -g 421344</code>.
    
    <img class="img-fluid z-dept-1 rounded shadow" src="/assets/img/Firefox4.png">
    </p>

    <p>Pausing just before the crash is good for taking a stack trace and understanding the program flow that leads to the assertion error. This was a significant help in my efforts to find the input source during my analysis of the source code. </p>

    <ol>
      <li><b>dom/serviceworkers/ServiceWorkerScriptCache.cpp</b> handles the initial input of the service worker into memory, and returns a successful status code when it is complete. </li>
      <li>multiple functions within <b>xpcom/string/nsTSubstring.cpp</b> perform parsing operations on the service worker, such as removing white-space from the file.</li>
      <li>After the white space is removed, the total size is checked, found to be too large, and causes the error.</li>
      <li><b>dist/include/mozilla/Assertions.h</b> is called after the assertion error and causes an unrecoverable crash in the faulty thread. In this case it is the parent thread of Firefox and the program crashes. This is the hard-coded null pointer dereference I had seen earlier. </li>
    </ol>

    <p> Selecting different stack frames in GDB allowed me to inspect the memory and locate the malicious input when it was first written. Creating break points and moving back and forth between functions with rr allowed me to see the modifications written by the string parsing functions. I tracked the *tainting* of local variables which included a variable called aLength being too large and triggering the assertion fault in nsTStringRepr.h. </p>

    <p> The phrase *tainted* refers to variables that are derived from attacker-controlled input. The malicious service worker was our input, saved with the name aData. The aLength value was derived from the length of aData. By controlling aData we have *tainted* aLength, which ultimately caused the crash. </p>

    <p> When examining variables GDB prints the contents of a memory location rather than the pointer address, except in this case the contents of the service worker were too large and it would hang. The command <code>(gdb) set print elements &lt;VALUE&gt;</code> is necessary to restrict the length of output. </p>

    <p>I wrote a small script to remove the addresses and decode the UTF-16 output given by GDB when reading the raw memory values. The following image shows the original service worker, in readable form, taken from the heap using GDB and rr. </p>

    <img class="img-fluid z-dept-1 rounded shadow" src="/assets/img/Firefox5.png"></p>

    <p>Before deriving the length of aData, the whitespace was stripped by string functions in Firefox. The following image shows the memory after the program made these changes.</p>

    <img class="img-fluid z-dept-1 rounded shadow" src="/assets/img/Firefox6.png"></p>

    <p>In reality, aData was actually tainted before aLength was derived. The above image is not the exact attacker-controlled input. This vulnerability shows an example of *taint propagation*, or a tainted variable tainting another variable. </p>

    <p>This taint propagation is the fundamental reason that a defensive crash is the best option at this point in the program flow. The boundary enforcement prevents the string functions from passing a value that is too large to be handled by other areas of the code, but it does not know why this value is corrupt. The string functions do not know what input source caused this corruption, or how many other variables are tainted.</p>

    <p>Further exploitation is prevented, but this crash is an example of a denial of service attack. It has a security impact and CVSS score because it impacts the availability of Firefox.</p>

    <p>The patch addresses these issues by moving the boundary enforcement to the input source. This is fundamentally different because when the boundary enforcement triggers an import failure, the program knows the cause, the scope of damage, and how to safely proceed.</p>

    <p>When attempting this exploit against a patched build of Firefox it shows 2 errors:
      <pre style="white-space: pre-wrap; word-wrap: break-word;"><code>
      [Parent 123573, Main Thread] WARNING: 'NS_FAILED(aStatus)', file /home/caleb/Documents/SecRe/firefox/firefox/dom/serviceworkers/ServiceWorkerScriptCache.cpp:287/n 
      [Parent 123573, Main Thread] WARNING: 'NS_FAILED(aStatus)', file /home/caleb/Documents/SecRe/firefox/firefox/dom/serviceworkers/ServiceWorkerUpdateJob.cpp:330
      </code></pre>
    The program then recovers and continues. The malicious service worker is not imported to the browser and does not result in a crash</p>

    <p>To accomplish this, a function was added in the file <b>dom/workers/WorkerCommon.h</b> which returns the maximum string length as the maximum size a worker script could be. </p>

    <p>Source code of the function:
    <pre style="white-space: pre-wrap; word-wrap: break-word;"><code>
    inline size_t GetWorkerScriptMaxSizeInBytes() {
        // This is the max size that any of our worker scripts can be.

        return nsString::LengthStorage::kMax;
    }
      </code></pre></p>

    <p>A check was added to ServiceWorkerScriptCache.cpp before returning a success code after importing a service worker. This check ensures the size of the service worker is less than the maximum.</p>

    <p>Source code of the function:
    <pre style="white-space: pre-wrap; word-wrap: break-word;"><code>
    if (aLen > GetWorkerScriptMaxSizeInBytes()) {
        rv = NS_ERROR_DOM_ABORT_ERR;  // This will make sure an exception gets
                                      // thrown to the global.
    return NS_OK;
    }
    </code></pre></p>

    <p><br></p>
    <h2>Lesson</h2>

    <p>During this project I learned a significant amount about browser internals. At one point I took a stack trace of over 100 threads to better understand the jobs that were being done internally to the browser. I added new tools to my homelab and I ran into and solved unique challenges with tools I thought I already knew. </p>

    <p>I read more of Firefox's source code, and debugged more of the program than was necessary for this analysis but I don't feel like it was a loss. Developing a better understanding of browser internals was a key motivation for this project all along. Learning about source to sink analysis and taint propagation really helped me to organize my efforts. </p>

    <p>Firefox is most recently estimated to have 150 million users. I am one of them and I am proud to have contributed to the project. </p>

    <p><br></p>
    <h2>Links</h2>
    <ul>
      <li><a href="https://cwe.mitre.org/data/definitions/617.html " target="_blank" rel="noopener noreferrer">CWE-617: Reachable Assertion</a></li>
      <li><a href="https://github.com/mozilla-firefox/firefox/commit/e784d5c2e5c5">Firefox Patch Commit</a></li>
      <li><a href="https://www.mozilla.org/en-US/security/advisories/mfsa2026-01/">Firefox Advisory</a></li>
      <li><a href="https://www.cve.org/CVERecord?id=CVE-2026-0889">CVE Record</a></li>
    </ul>




    







</div>

    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2025 Caleb Lerch. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>.

      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script src="/assets/js/common.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    
  </body>
</html>

